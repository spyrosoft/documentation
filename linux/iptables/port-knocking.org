KnockKnock by Moxie Marlinspike

Source: http://www.thoughtcrime.org/software/knockknock/

* CentOS7 doesn't use kern.log as is expected in knockknock

** Change the file name in knockknock to /etc/rsyslog.d/00-iptables.log and run the installation

** Place the following in /etc/rsyslog.d/00-iptables.log
:msg,contains,"REJECT " -/var/log/iptables.log

** Now restart rsyslog to start using the new settings
systemctl restart rsyslog.service

* Run knockknock-genprofile as specified

* Copy /etc/knockknock.d/profiles/new-profile to your local machine as described in the documentation

* Remove all chains and rules from iptables (TEMPORARILY) and save them, so you can power cycle your server if you get locked out - and save them
(CentOS)
service iptables save
(Other - find where the iptables config file is and write over it with the new rules - here are two examples)
iptables-save > /etc/sysconfig/iptables
iptables-save > /etc/iptables/iptables.rules

* Run the following script to configure iptables (or do it yourself - notice that my settings are different than the documentation's - I need the loopback interface to work)
https://github.com/spyrosoft/shell-scripts/blob/master/sysadmin/configure-knockknock

* Enable the daemon on startup (or you will lock yourself out of your server once the knockknock iptables rules are in place), which is oddly nowhere to be found in the documentation
(systemd: write the following to /etc/systemd/system/knockknock.service)
[Unit]
Description=Knock Knock Daemon
After=syslog.target network.target iptables.service

[Service]
ExecStart=/usr/bin/knockknock-daemon
ExecStop=/usr/bin/kallall knockknock-daemon
Type=forking
GuessMainPID=no

[Install]
WantedBy=multi-user.target

* TEST THIS
(server)
systemctl start knockknock.service
systemctl status knockknock.service
(make sure it's running and everything's good)
(local)
ssh root@example.com
(if you can't get in, something is horribly wrong - power cycle your server to get back in and fix it before you continue any farther)
(server)
reboot
(local)
ssh root@example.com
(server)
systemctl status knockknock.service
(make sure it's running and everything's good)

* Now that we know that knockknock.service works on boot, run the configure-knockknock script again, and this time save iptables to disk
service iptables save
(or the other way mentioned above)

* Reboot the server and log back in - now you're using knockknock - yay




Naive Port Knocking

https://github.com/spyrosoft/shell-scripts/blob/master/archive/configure-port-knocking